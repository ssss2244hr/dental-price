# ==============================================================================
# [í•„ìˆ˜] ì‹¤í–‰ ì „ í„°ë¯¸ë„(ëª…ë ¹ í”„ë¡¬í”„íŠ¸)ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì„œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!
# pip install selenium webdriver-manager
# ==============================================================================

import time
import sys

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸
try:
    from selenium import webdriver
    from selenium.webdriver.chrome.service import Service
    from selenium.webdriver.common.by import By
    from selenium.webdriver.common.keys import Keys
    from selenium.webdriver.chrome.options import Options
    from webdriver_manager.chrome import ChromeDriverManager
except ImportError:
    print("\nâŒ ì˜¤ë¥˜: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    print("   í„°ë¯¸ë„ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì„œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”:")
    print("   pip install selenium webdriver-manager\n")
    sys.exit(1)

# ==============================================================================
# [ì„¤ì • êµ¬ì—­] ìì£¼ ê°€ëŠ” ì‡¼í•‘ëª°ë“¤ì„ ì—¬ê¸°ì— ë“±ë¡í•˜ì„¸ìš”!
# ==============================================================================

MY_SITES = {
    # [1] ë´íƒˆëª¨ì•„ (ì˜ˆì‹œ)
    "dentalmore": {
        "name": "ë´íƒˆëª¨ì•„",
        # 1. ë¡œê·¸ì¸ ì •ë³´
        "login_url": "https://www.dentalmore.com/member/login.html",
        "id": "doctor1234",
        "pw": "password!",
        "selectors": {
            "id": "#member_id",      # ì•„ì´ë”” ì…ë ¥ì°½
            "pw": "#member_passwd",  # ë¹„ë²ˆ ì…ë ¥ì°½
        },
        # 2. ê²€ìƒ‰ ì„¤ì • (ê²€ìƒ‰ì–´ ë¶€ë¶„ì€ {}ë¡œ ë¹„ì›Œë‘ì„¸ìš”)
        "search_url": "https://www.dentalmore.com/shop/search.php?q={}",
        # 3. ê²°ê³¼ ê¸ì–´ì˜¤ê¸° ì„¤ì • (F12ë¡œ ì°¾ì•„ì•¼ í•¨)
        "result_selectors": {
            "item": ".product_item", # ìƒí’ˆ 1ê°œë¥¼ ê°ì‹¸ëŠ” ë°•ìŠ¤
            "name": ".name",         # ìƒí’ˆëª…
            "price": ".price"        # ê°€ê²©
        }
    },
    
    # [2] ì´ë´íŠ¸ (ì§ì ‘ ì±„ì›Œë³´ì„¸ìš”!)
    "ident": {
        "name": "ì´ë´íŠ¸",
        "login_url": "https://www.ident.co.kr/login",
        "id": "my_id",
        "pw": "my_pw",
        "selectors": {
            "id": "#login_id",
            "pw": "#login_pw",
        },
        "search_url": "https://www.ident.co.kr/search?keyword={}",
        "result_selectors": {
            "item": ".goods_list li", # ë¦¬ìŠ¤íŠ¸ì˜ ê° í•­ëª©
            "name": ".goods_name",
            "price": ".goods_price"
        }
    }
}

# ==============================================================================

def run_personal_searcher():
    # 1. ê²€ìƒ‰ì–´ ì…ë ¥ ë°›ê¸°
    keyword = input("\nğŸ” ê²€ìƒ‰í•  í’ˆëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: Z250): ")
    if not keyword: return

    print("\nğŸ¤– ë¸Œë¼ìš°ì €ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤...")
    chrome_options = Options()
    # chrome_options.add_argument("--headless") # ë¸Œë¼ìš°ì € ì°½ ì•ˆ ë³´ë ¤ë©´ ì£¼ì„ í•´ì œ
    
    try:
        driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=chrome_options)
        driver.implicitly_wait(5)
    except Exception as e:
        print(f"\nâŒ ë¸Œë¼ìš°ì € ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        print("   (í¬ë¡¬ ë¸Œë¼ìš°ì €ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.)")
        return

    print(f"\n--- '{keyword}' ê°€ê²© ê²€ìƒ‰ ì‹œì‘ ---\n")

    for site_key, config in MY_SITES.items():
        site_name = config['name']
        print(f"ğŸ¢ [{site_name}] ì ‘ì† ì¤‘...")

        try:
            # 1. ë¡œê·¸ì¸ (ë¨¼ì € ë¡œê·¸ì¸í•´ì•¼ íšŒì›ê°€ê°€ ë³´ì„)
            driver.get(config['login_url'])
            time.sleep(1)
            
            # ì´ë¯¸ ë¡œê·¸ì¸ ë˜ì–´ ìˆëŠ”ì§€ ì²´í¬í•˜ëŠ” ë¡œì§ì€ ìƒëµ (ë‹¨ìˆœí™”)
            try:
                driver.find_element(By.CSS_SELECTOR, config['selectors']['id']).send_keys(config['id'])
                driver.find_element(By.CSS_SELECTOR, config['selectors']['pw']).send_keys(config['pw'])
                driver.find_element(By.CSS_SELECTOR, config['selectors']['pw']).send_keys(Keys.RETURN)
                time.sleep(2) # ë¡œê·¸ì¸ ëŒ€ê¸°
            except:
                print("   (ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì´ê±°ë‚˜ ì…ë ¥ì°½ì„ ëª» ì°¾ìŒ)")

            # 2. ê²€ìƒ‰ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™
            # ê²€ìƒ‰ì°½ì— íƒ€ì´í•‘í•˜ëŠ” ê²ƒë³´ë‹¤, ì£¼ì†Œì°½ì— ê²€ìƒ‰ì–´ë¥¼ ë„£ëŠ” ê²Œ í›¨ì”¬ ë¹ ë¥´ê³  ì •í™•í•©ë‹ˆë‹¤.
            target_url = config['search_url'].format(keyword)
            driver.get(target_url)
            time.sleep(2)

            # 3. ê²°ê³¼ ê¸ì–´ì˜¤ê¸°
            items = driver.find_elements(By.CSS_SELECTOR, config['result_selectors']['item'])
            
            print(f"   âœ“ ê²€ìƒ‰ ê²°ê³¼ {len(items)}ê°œ ë°œê²¬")
            
            # ìƒìœ„ 3ê°œë§Œ ë³´ì—¬ì£¼ê¸°
            count = 0
            for item in items:
                if count >= 3: break # ë„ˆë¬´ ë§ì´ ë‚˜ì˜¤ë©´ ë³´ê¸° í˜ë“œë‹ˆê¹Œ 3ê°œë§Œ
                try:
                    name = item.find_element(By.CSS_SELECTOR, config['result_selectors']['name']).text
                    price = item.find_element(By.CSS_SELECTOR, config['result_selectors']['price']).text
                    print(f"      - {name} : {price}")
                    count += 1
                except:
                    continue
            
            if count == 0:
                print("      (ìƒí’ˆ ì •ë³´ë¥¼ ì½ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. Selectorë¥¼ í™•ì¸í•˜ì„¸ìš”)")

        except Exception as e:
            print(f"   X ì˜¤ë¥˜ ë°œìƒ: {e}")
        
        print("-" * 30)

    print("\nâœ¨ ëª¨ë“  ê²€ìƒ‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
    # ê²°ê³¼ë¥¼ í™•ì¸í•˜ë„ë¡ ë°”ë¡œ ë„ì§€ ì•Šê³  ì…ë ¥ì„ ê¸°ë‹¤ë¦¼
    input("ì¢…ë£Œí•˜ë ¤ë©´ ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ì„¸ìš”...")
    driver.quit()

if __name__ == "__main__":
    run_personal_searcher()
